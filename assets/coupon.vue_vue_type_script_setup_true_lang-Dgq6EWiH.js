import{h as A,j as B}from"./shop-D0qIET65.js";import{u as N}from"./index-LY3ioL-D.js";import{bc as R,aF as q,S as D,aw as M,K as O,N as S,F as T,am as U}from"./antd-DotIiKV0.js";import{d as V,f as m,s as $,w as j,a5 as f,a3 as E,u,ac as C,ad as o,k as a,G as r,af as G,H,F as K}from"./vue-DIvP5FMT.js";const W=V({__name:"coupon",props:{shopId:{type:Number,require:!0}},emits:["applyCoupon"],setup(y,{expose:k,emit:w}){const l=y,d=w,t=m({coupon:""}),_=$(),s=m(!1),n=m({couponCode:"",discountedPrice:-1});async function g(){_.value.validate().then(async()=>{const{data:c}=await A(t.value.coupon,l.shopId);n.value={couponCode:t.value.coupon,discountedPrice:c};const e=N();d("applyCoupon",n.value),e.success("ä¼˜æƒ ç ä½¿ç”¨æˆåŠŸ ðŸ˜„",3),s.value=!1})}async function v(){const{data:c}=await B(t.value.coupon,l.shopId);n.value.discountedPrice=c,d("applyCoupon",n.value)}function h(){t.value.coupon="",n.value.discountedPrice=-1,d("applyCoupon",n.value)}return j(()=>l.shopId,()=>{n.value.couponCode&&v()}),k({coupon:t.value.coupon,shopId:l.shopId,sliceApplyCoupon:v}),(c,e)=>{const i=D,I=M,x=O,F=S,P=T,b=U;return f(),E(K,null,[u(n).discountedPrice<0?(f(),C(i,{key:0,onClick:e[0]||(e[0]=p=>s.value=!0)},{icon:o(()=>[a(u(R))]),default:o(()=>[r(" ä½¿ç”¨ä¼˜æƒ ç  ")]),_:1})):(f(),C(I,{key:1,title:"ç¡®å®šè¦å–æ¶ˆä½¿ç”¨ä¼˜æƒ ç ï¼Ÿ",onConfirm:h},{default:o(()=>[a(i,{type:"dashed"},{icon:o(()=>[a(u(q))]),default:o(()=>[r(" "+G(u(n).couponCode),1)]),_:1})]),_:1})),a(b,{open:u(s),"onUpdate:open":e[3]||(e[3]=p=>H(s)?s.value=p:null),closable:!1,title:"ä½¿ç”¨ä¼˜æƒ ç ",width:400},{footer:o(()=>[a(i,{type:"primary",onClick:g},{default:o(()=>[r("ä½¿ç”¨")]),_:1}),a(i,{onClick:e[1]||(e[1]=p=>s.value=!1)},{default:o(()=>[r("å–æ¶ˆ")]),_:1})]),default:o(()=>[a(P,{ref_key:"formRef",ref:_,model:u(t)},{default:o(()=>[a(F,{name:"coupon",rules:[{required:!0,message:"è¯·è¾“å…¥ä¼˜æƒ ç "}]},{default:o(()=>[a(x,{value:u(t).coupon,"onUpdate:value":e[2]||(e[2]=p=>u(t).coupon=p)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])],64)}}});export{W as _};

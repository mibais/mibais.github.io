import{P as n,_ as R,c as V,p as F,a as O}from"./index.vue_vue_type_script_setup_true_lang-CQ5WkF_H.js";import{u as T}from"./index-PoV8YKeN.js";import{d as z,az as v,aA as g,s as $,f as d,w as E,a5 as w,a3 as G,k as s,ad as p,u as o,G as J,ac as K,ag as Q,F as U}from"./vue-BVKynzoK.js";import{bd as j,V as D,K as H,aA as I,aS as L,am as W}from"./antd-9nlSCyVV.js";const ae=z({__name:"alipay-qrcode",props:v({payPrice:{type:String,required:!0}},{payClient:{},payClientModifiers:{},open:{type:Boolean,default:!1},openModifiers:{}}),emits:v(["close"],["update:payClient","update:open"]),setup(r,{emit:k}){const u=r,C=T(),l=g(r,"payClient"),i=g(r,"open"),f=k,c=$(),m=d(""),t=d(""),y=d(!1);async function P(){const{data:e}=await O({type:n.alipay,payPrice:u.payPrice});t.value=e}async function S(){await c.value.createSse(t.value,"charge")}async function M(){y.value=!0,await P(),await S();const{data:e}=await V({type:n.alipay,payPrice:u.payPrice,tradeNo:t.value});m.value=e,y.value=!1}function b(e){const a=JSON.parse(e);a.charge&&a.payPrice==u.payPrice&&(f("close",!0),c.value.closeSse("charge",t.value))}async function h(){const{data:e}=await F(t.value);["paid","finished"].includes(e)?(f("close",!0),c.value.closeSse("charge",t.value)):C.warning("付款尚未成功")}return E(i,()=>{i.value&&l.value===n.alipay&&M()}),(e,a)=>{const N=D,A=H,B=I,x=L,q=W;return w(),G(U,null,[s(R,{ref_key:"sseRef",ref:c,onReceiveMsg:b},null,512),s(N,{class:"payButton",type:l.value===o(n).alipay?"primary":"default",onClick:a[0]||(a[0]=_=>l.value=o(n).alipay)},{icon:p(()=>[s(o(j))]),default:p(()=>[J(" 支付宝 ")]),_:1},8,["type"]),l.value===o(n).alipay?(w(),K(q,{key:0,open:i.value,"onUpdate:open":a[1]||(a[1]=_=>i.value=_),"ok-text":"已支付",keyboard:!1,"mask-closable":!1,closable:!1,width:320,"cancel-button-props":{disabled:!0},title:"支付宝扫码支付",onOk:h},{default:p(()=>[s(A,{type:"warning",message:"支付成功后页面长时间无响应请点击已支付按钮"}),s(x,{spinning:o(y),tip:"付款码正在加载中"},{default:p(()=>[s(B,{size:270,value:o(m)},null,8,["value"])]),_:1},8,["spinning"])]),_:1},8,["open"])):Q("",!0)],64)}}});export{ae as _};

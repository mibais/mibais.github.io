import{q as g,a as O,v as R}from"./index-CknsXAG9.js";import{d as k,a5 as M,a3 as b,az as w,aA as C,s as D,f as v,w as F,k as n,ad as f,u as y,G as I,F as U}from"./vue-DIvP5FMT.js";import{bd as V,V as z,K as G,aA as J,aS as K,am as Q}from"./antd-DWod4DQe.js";var c=(e=>(e.alipay="alipay",e.paypal="paypal",e))(c||{});function T(e){return g("/payment/process",e,{customDev:!0})}function j(e){return g("/payment/payStatus",{tradeNo:e},{customDev:!0})}function H(e){return g("/payment/createOrder",e,{customDev:!0})}const L=k({__name:"index",emits:["receiveMsg"],setup(e,{expose:m,emit:u}){const p=u;async function s(l){var o;if(window.EventSource){const r=(o=O().userInfo)==null?void 0:o.id,i=new EventSource(`${R}/sse/create/chargeEvent?tradeNo=${l}&userId=${r}`);i.onmessage=function(d){d.data&&p("receiveMsg",d.data)},i.onerror=d=>{}}}return m({createSse:s}),(l,o)=>(M(),b("div"))}}),Z=k({__name:"alipay-qrcode",props:w({payPrice:{type:String,required:!0}},{payClient:{},payClientModifiers:{},open:{type:Boolean,default:!1},openModifiers:{}}),emits:w(["close"],["update:payClient","update:open"]),setup(e,{emit:m}){const u=e,p=C(e,"payClient"),s=C(e,"open"),l=m,o=D(),_=v(""),r=v(""),i=v(!1);async function d(){const{data:a}=await H({type:c.alipay,payPrice:u.payPrice});r.value=a}async function x(){await o.value.createSse(r.value)}async function P(){i.value=!0,await d(),await x();const{data:a}=await T({type:c.alipay,payPrice:u.payPrice,tradeNo:r.value});_.value=a,i.value=!1}function N(a){const t=JSON.parse(a);t.charge&&t.payPrice==u.payPrice&&l("close",!0)}async function h(){const{data:a}=await j(r.value);["paid","finished"].includes(a)&&l("close",!0)}return F(s,()=>{s.value&&p.value===c.alipay&&P()}),(a,t)=>{const A=z,q=G,B=J,$=K,E=Q;return M(),b(U,null,[n(L,{ref_key:"sseRef",ref:o,onReceiveMsg:N},null,512),n(A,{class:"payButton",type:p.value===y(c).alipay?"primary":"default",onClick:t[0]||(t[0]=S=>p.value=y(c).alipay)},{icon:f(()=>[n(y(V))]),default:f(()=>[I(" 支付宝 ")]),_:1},8,["type"]),n(E,{open:s.value,"onUpdate:open":t[1]||(t[1]=S=>s.value=S),"ok-text":"已支付",keyboard:!1,"mask-closable":!1,closable:!1,width:320,"cancel-button-props":{disabled:!0},title:"支付宝扫码支付",onOk:h},{default:f(()=>[n(q,{type:"warning",message:"支付成功后页面长时间无响应请点击已支付按钮"}),n($,{spinning:y(i),tip:"付款码正在加载中"},{default:f(()=>[n(B,{size:270,value:y(_)},null,8,["value"])]),_:1},8,["spinning"])]),_:1},8,["open"])],64)}}});export{c as P,Z as _};

import{b5 as j,d as q,V as E,m as H,K,a0 as O,ao as z,aa as J,ab as L,be as Q,av as W,am as X}from"./antd-DWod4DQe.js";import{c as Z,b as ee}from"./bought-BqEH8zT7.js";import{u as ne,a as ae}from"./index-BfYayhMd.js";import{d as te,f as u,c as oe,w,ab as le,a5 as G,a3 as se,k as e,ad as n,u as a,G as s,a8 as p,ac as ue,af as i,ag as re,H as k,F as _e}from"./vue-DIvP5FMT.js";const pe=p("br",null,null,-1),de=te({__name:"traffic-package",props:{open:{type:Boolean,default:!1}},emits:["update:open"],setup(C,{emit:T}){const D=C,M=T,o=u(10),r=u(!1),P=u(!1),m=u(0),b=u(),B=ne(),f=ae(),c=oe(()=>o.value*m.value);w(c,t=>{P.value=t>f.userInfo.money}),w(()=>D.open,t=>{t&&(x(),M("update:open",!1))});const V=u({100:"100GB",300:"300GB",500:{style:{color:"#f50"},label:"500GB"},700:"700GB",1e3:"1000GB"});async function $(){const{data:t}=await Z();return t?(m.value=t.unitPrice,b.value=t.nextRestTime?q(t.nextRestTime).format("YYYY-MM-DD"):"永不到期",!0):(B.warning("请先购买套餐"),!1)}async function x(){r.value=await $()}const d=u(!1);async function h(){if(c.value>f.userInfo.money){d.value=!0;return}await ee(o.value),r.value=!1,B.success("流量购买成功！")}return(t,l)=>{const g=E,N=H,R=le("router-link"),S=K,U=O,Y=z,v=J,y=L,A=Q,I=W,F=X;return G(),se(_e,null,[e(g,{type:"primary",onClick:x},{icon:n(()=>[e(a(j))]),default:n(()=>[s(" 购买流量包 ")]),_:1}),e(F,{open:a(r),"onUpdate:open":l[3]||(l[3]=_=>k(r)?r.value=_:null),title:"购买流量包",width:"680px"},{footer:n(()=>[e(N,null,{default:n(()=>[e(g,{style:{"margin-right":"8px"},onClick:l[0]||(l[0]=_=>{r.value=!1,d.value=!1})},{default:n(()=>[s("取消")]),_:1}),e(g,{type:"primary",onClick:h},{default:n(()=>[s("购买")]),_:1})]),_:1})]),default:n(()=>[p("div",null,[a(d)?(G(),ue(S,{key:0,type:"info"},{message:n(()=>[s(i(`余额不足。流量包总价${a(c)}元，账户余额${a(f).userInfo.money}元`)+"。请先 ",1),e(R,{to:"/charge/wallet"},{default:n(()=>[s("充值")]),_:1})]),_:1})):re("",!0),e(y,null,{default:n(()=>[e(v,{span:24},{default:n(()=>[e(Y,null,{default:n(()=>[p("blockquote",null,[s(" 购买的流量包与当前套餐绑定，并只在当前周期有效。"),pe,s("当前周期到期时间："),e(U,{color:"#108ee9"},{default:n(()=>[s(i(a(b)),1)]),_:1})])]),_:1})]),_:1})]),_:1}),e(y,{gutter:42},{default:n(()=>[e(v,{xs:24,sm:24,md:16,lg:16},{default:n(()=>[e(A,{value:a(o),"onUpdate:value":l[1]||(l[1]=_=>k(o)?o.value=_:null),min:1,max:1e3,step:5,marks:a(V)},null,8,["value","marks"])]),_:1}),e(v,{md:8,lg:8},{default:n(()=>[e(I,{value:a(o),"onUpdate:value":l[2]||(l[2]=_=>k(o)?o.value=_:null),placeholder:"输入你要购买的流量","addon-after":"GB",min:1,max:1e3,step:5},null,8,["value"])]),_:1})]),_:1}),e(y,{"mt-5":""},{default:n(()=>[p("ul",null,[p("li",null,"当前套餐单价："+i(a(m))+"元/GB",1),p("li",null,"流量总计价格："+i(a(c))+"元",1)])]),_:1})])]),_:1},8,["open"])],64)}}});export{de as _};

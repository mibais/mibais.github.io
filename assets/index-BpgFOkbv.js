import{_ as ie}from"./index.vue_vue_type_script_setup_true_lang-Dfax-ieA.js";import{aP as ue,d as $,aQ as ce,N as re,O as _e,aa as pe,av as me,ab as fe,V as ge,m as ve,F as he,a9 as xe,S as ke,aR as ye,D as Ce,ag as Ie,aw as be,an as we,s as Se}from"./antd-D-bStUmV.js";import{n as Ae,_ as De,d as Le}from"./edit.vue_vue_type_script_setup_true_lang-Fd00WJHY.js";import{u as Re}from"./index-CDfL52KE.js";import{d as Ve,f as r,s as H,c as M,r as U,w as ze,o as Be,a5 as p,ac as V,ad as t,k as a,u as n,G as d,H as Ne,a3 as I,F as b,af as w,ag as m,ak as Ye,a8 as $e}from"./vue-BVKynzoK.js";import"./context-HJdaDJQ4.js";const He=$e("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"节点管理",-1),Qe=Ve({__name:"index",setup(Me){const k=r(!1),S=r(!1),y=H(!0),A=H([{title:"#",dataIndex:"id"},{title:"节点名称",dataIndex:"name"},{title:"节点地址",dataIndex:"server",width:120,ellipsis:!0},{title:"是否可见",dataIndex:"type"},{title:"流量倍率",dataIndex:"trafficRate"},{title:"节点等级",dataIndex:"nodeClass"},{title:"节点类型",dataIndex:"sort"},{title:"节点限速",dataIndex:"nodeSpeedlimit"},{title:"节点连接数",dataIndex:"nodeConnector"},{title:"节点使用流量",dataIndex:"nodeBandwidth"},{title:"节点总流量",dataIndex:"nodeBandwidthLimit"},{title:"节点流量重置日",dataIndex:"bandwidthlimitResetday"},{title:"上次活动时间",dataIndex:"nodeHeartbeat"},{title:"节点ip",dataIndex:"nodeIp"},{title:"节点分组",dataIndex:"nodeGroup"},{title:"操作",dataIndex:"action",width:200}]),i=M(()=>A.value.map(e=>e.dataIndex)),z=r(),s=U({indeterminate:!1,checkAll:!0,checkList:i.value}),F={0:"Shadowsocks",2:"SSH",5:"Anyconnect",9:"Shadowsocks 单端口多用户",10:"Shadowsocks 中转",11:"V2ray",12:"V2ray 中转",14:"Trojan",999:"系统保留"},O=M(()=>A.value.map(e=>e.dataIndex==="action"?{label:e.title,value:e.dataIndex,disabled:!0}:{label:e.title,value:e.dataIndex})),B=r(),u=U({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`${e}条记录`,onChange(e,o){u.pageSize=o,u.current=e,g()}}),c=r({name:"",server:"",nodeClass:void 0}),f=r(!1);async function g(){if(!k.value){k.value=!0;try{const{data:e}=await Ae({size:u.pageSize,current:u.current,param:c.value});B.value=e.records,u.total=e.total,u.pageSize=e.size,u.current=e.current}finally{k.value=!1}}}function v(e){return A.value.filter(o=>e.includes(o.dataIndex))}const j=["id","name","nodeClass","sort","type","nodeGroup","action"],h=r(y.value?v(j):v(i.value));function T(e){y.value=!1,Object.assign(s,{checkList:e.target.checked?i.value:[],indeterminate:!0}),h.value=e.target.checked?v(i.value):h.value.filter(o=>o.dataIndex==="action")}ze(()=>s.checkList,e=>{s.indeterminate=!!e.length&&e.length<i.value.length,s.checkAll=e.length===i.value.length});function G(){s.checkList=i.value,h.value=v(i.value),y.value=!0}const Q=r();function E(){g()}function J(e){y.value=!1;const o=v(e);h.value=o}function P(e){z.value=e.id,f.value=!0}async function q(e){await Le(e),Re().success("节点删除成功"),await g()}function K(e){f.value=!1,e&&g()}return Be(()=>{g()}),(e,o)=>{const N=re,D=_e,x=pe,W=me,L=fe,C=ge,Y=ve,X=he,R=xe,Z=ke,ee=ye,te=Ce,ae=Ie,ne=be,oe=we,le=Se,se=ie;return p(),V(se,null,{title:t(()=>[He]),default:t(()=>[a(R,{"mb-4":""},{default:t(()=>[a(X,{modal:n(c)},{default:t(()=>[a(L,{gutter:16},{default:t(()=>[a(x,{span:8},{default:t(()=>[a(D,{label:"节点名",name:"name"},{default:t(()=>[a(N,{value:n(c).name,"onUpdate:value":o[0]||(o[0]=l=>n(c).name=l)},null,8,["value"])]),_:1})]),_:1}),a(x,{span:8},{default:t(()=>[a(D,{label:"节点地址",name:"server"},{default:t(()=>[a(N,{value:n(c).server,"onUpdate:value":o[1]||(o[1]=l=>n(c).server=l)},null,8,["value"])]),_:1})]),_:1}),a(x,{span:8},{default:t(()=>[a(D,{label:"节点等级",name:"nodeClass"},{default:t(()=>[a(W,{value:n(c).nodeClass,"onUpdate:value":o[2]||(o[2]=l=>n(c).nodeClass=l),min:0},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(L,{span:24,style:{"text-align":"right"}},{default:t(()=>[a(x,{span:24},{default:t(()=>[a(Y,{flex:"","justify-end":"","w-full":""},{default:t(()=>[a(C,{loading:n(Q),type:"primary",onClick:E},{default:t(()=>[d(" 查询 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modal"])]),_:1}),a(L,{gutter:24},{default:t(()=>[a(x,{span:24},{default:t(()=>[a(R,{title:"节点列表"},{extra:t(()=>[a(ae,{title:"列设置"},{default:t(()=>[a(te,{open:n(S),"onUpdate:open":o[5]||(o[5]=l=>Ne(S)?S.value=l:null),trigger:"click"},{overlay:t(()=>[a(R,null,{title:t(()=>[a(Z,{checked:n(s).checkAll,"onUpdate:checked":o[3]||(o[3]=l=>n(s).checkAll=l),indeterminate:n(s).indeterminate,onChange:T},{default:t(()=>[d(" 列选择 ")]),_:1},8,["checked","indeterminate"])]),extra:t(()=>[a(C,{type:"link",onClick:G},{default:t(()=>[d(" 重置 ")]),_:1})]),default:t(()=>[a(ee,{value:n(s).checkList,"onUpdate:value":o[4]||(o[4]=l=>n(s).checkList=l),options:n(O),style:{display:"flex","flex-direction":"column"},onChange:J},null,8,["value","options"])]),_:1})]),default:t(()=>[a(n(ue))]),_:1},8,["open"])]),_:1})]),default:t(()=>[a(oe,{loading:n(k),columns:n(h),"data-source":n(B),pagination:n(u),scroll:{x:100}},{bodyCell:t(({column:l,record:_})=>[l.dataIndex==="sort"?(p(),I(b,{key:0},[d(w(F[_.sort]),1)],64)):m("",!0),l.dataIndex==="bandwidthlimitResetday"?(p(),I(b,{key:1},[d(w(_.bandwidthlimitResetday?n($)(_.bandwidthlimitResetday).format("YYYY-MM-DD"):""),1)],64)):m("",!0),l.dataIndex==="type"?(p(),I(b,{key:2},[d(w(_.type===1?"可见":"隐藏"),1)],64)):m("",!0),l.dataIndex==="nodeHeartbeat"?(p(),I(b,{key:3},[d(w(n($)(_.nodeHeartbeat).format("YYYY-MM-DD")),1)],64)):m("",!0),l.dataIndex==="action"?(p(),V(Y,{key:4},{default:t(()=>[a(C,{type:"default",onClick:de=>P(_)},{default:t(()=>[d(" 修改 ")]),_:2},1032,["onClick"]),a(ne,{title:"确定要删除节点吗？",onConfirm:de=>q(_.id)},{icon:t(()=>[a(n(ce))]),default:t(()=>[a(C,{danger:"",type:"primary"},{default:t(()=>[d(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):m("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1})]),_:1})]),_:1}),a(le,{title:"编辑节点",width:720,visible:n(f),"body-style":{paddingBottom:"80px"},onClose:o[6]||(o[6]=l=>f.value=!1)},{default:t(()=>[n(f)?(p(),V(Ye(De),{key:0,"node-id":n(z),onHandleClose:K},null,40,["node-id"])):m("",!0)]),_:1},8,["visible"])]),_:1})}}});export{Qe as default};

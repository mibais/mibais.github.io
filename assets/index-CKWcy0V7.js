import{_ as ge}from"./index.vue_vue_type_script_setup_true_lang-ChuEzVa1.js";import{aP as ve,d as H,aQ as ke,N as xe,O as ye,aa as he,av as Ce,aJ as be,aK as we,ab as Ie,aL as Ue,V as $e,m as Se,F as De,a9 as Le,S as ze,aR as Ee,D as Ne,ag as Ae,a0 as Ye,aw as Re,an as Be,s as Me}from"./antd-DWod4DQe.js";import{U as k}from"./enum-KIDSNew-.js";import{u as Oe,_ as Ve,d as Te}from"./edit.vue_vue_type_script_setup_true_lang-CruJXbPS.js";import{_ as Fe}from"./charge.vue_vue_type_script_setup_true_lang-ZmtaS6_O.js";import{_ as He}from"./bought.vue_vue_type_script_setup_true_lang-BPBS-PLb.js";import{u as je}from"./index-BhAGI5mP.js";import{d as Qe,f as p,s as j,c as O,r as Q,w as Je,o as Pe,a5 as i,ac as _,ad as e,k as t,u as a,a3 as L,F as z,al as Ge,G as u,af as m,H as Ke,ag as d,ak as J,a8 as qe}from"./vue-DIvP5FMT.js";import"./context-BiCfceRa.js";import"./code-Bc9ojHa1.js";import"./bought-BXAemHLN.js";const We=qe("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"用户管理",-1),dt=Qe({__name:"index",setup(Xe){const I=p(!1),E=p(!1),N=j([{title:"邮箱",dataIndex:"email",width:120,ellipsis:!0},{title:"用户名",dataIndex:"userName"},{title:"余额",dataIndex:"money"},{title:"剩余流量",dataIndex:"leftTraffic"},{title:"等级",dataIndex:"grade"},{title:"等级到期",dataIndex:"classExpire"},{title:"注册时间",dataIndex:"regDate"},{title:"状态",dataIndex:"status"},{title:"操作",dataIndex:"action",fixed:"right",width:350}]),f=O(()=>N.value.map(n=>n.dataIndex)),A=p(),c=Q({indeterminate:!1,checkAll:!0,checkList:f.value}),P=O(()=>N.value.map(n=>n.dataIndex==="action"?{label:n.title,value:n.dataIndex,disabled:!0}:{label:n.title,value:n.dataIndex})),G=O(()=>{const n={};for(const l in k)n[l]=k[l];return n}),V=p(),g=Q({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:n=>`${n}条记录`,onChange(n,l){g.pageSize=l,g.current=n,b()}}),r=p({}),y=p(!1);async function b(){if(!I.value){I.value=!0;try{const{data:n}=await Oe({size:g.pageSize,current:g.current,param:r.value});V.value=n.records,g.total=n.total,g.pageSize=n.size,g.current=n.current}finally{I.value=!1}}}function U(n){return N.value.filter(l=>n.includes(l.dataIndex))}const w=p(U(f.value));function K(n){Object.assign(c,{checkList:n.target.checked?f.value:[],indeterminate:!0}),w.value=n.target.checked?U(f.value):w.value.filter(l=>l.dataIndex==="action")}Je(()=>c.checkList,n=>{c.indeterminate=!!n.length&&n.length<f.value.length,c.checkAll=n.length===f.value.length});function q(){c.checkList=f.value,w.value=U(f.value)}const W=p();function X(){b()}function Z(n){w.value=U(n)}function ee(n){A.value=n.id,y.value=!0}async function te(n){await Te(n),je().success("用户删除成功"),await b()}function ae(){A.value=void 0,y.value=!0}function ne(n){y.value=!1,n&&b()}const $=p(!1),S=j(),Y=p();return Pe(()=>{b()}),(n,l)=>{const T=xe,h=ye,v=he,le=Ce,oe=be,se=we,D=Ie,F=Ue,x=$e,R=Se,ue=De,B=Le,ie=ze,re=Ee,de=Ne,_e=Ae,C=Ye,ce=Re,pe=Be,me=Me,fe=ge;return i(),_(fe,null,{title:e(()=>[We]),default:e(()=>[t(B,{"mb-4":""},{default:e(()=>[t(ue,{modal:a(r)},{default:e(()=>[t(D,{gutter:16},{default:e(()=>[t(v,{span:6},{default:e(()=>[t(h,{label:"用户名",name:"userName"},{default:e(()=>[t(T,{value:a(r).userName,"onUpdate:value":l[0]||(l[0]=o=>a(r).userName=o)},null,8,["value"])]),_:1})]),_:1}),t(v,{span:6},{default:e(()=>[t(h,{label:"邮箱",name:"email"},{default:e(()=>[t(T,{value:a(r).email,"onUpdate:value":l[1]||(l[1]=o=>a(r).email=o)},null,8,["value"])]),_:1})]),_:1}),t(v,{span:4},{default:e(()=>[t(h,{label:"用户等级",name:"grade"},{default:e(()=>[t(le,{value:a(r).grade,"onUpdate:value":l[2]||(l[2]=o=>a(r).grade=o),min:0},null,8,["value"])]),_:1})]),_:1}),t(v,{span:4},{default:e(()=>[t(h,{label:"状态",name:"status"},{default:e(()=>[t(se,{value:a(r).status,"onUpdate:value":l[3]||(l[3]=o=>a(r).status=o),"allow-clear":!0},{default:e(()=>[(i(!0),L(z,null,Ge(a(G),(o,s)=>(i(),_(oe,{key:s,value:s},{default:e(()=>[u(m(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(D,{gutter:16},{default:e(()=>[t(v,{span:8},{default:e(()=>[t(h,{label:"等级到期"},{default:e(()=>[t(F,{allowEmpty:[!0,!0],placeholder:["开始日期","结束日期"],onChange:l[4]||(l[4]=(o,s)=>{a(r).startClassExpire=s[0],a(r).endClassExpire=s[1]})})]),_:1})]),_:1}),t(v,{span:8},{default:e(()=>[t(h,{label:"注册时间"},{default:e(()=>[t(F,{allowEmpty:[!0,!0],placeholder:["开始日期","结束日期"],onChange:l[5]||(l[5]=(o,s)=>{a(r).startRegTime=s[0],a(r).endRegTime=s[1]})})]),_:1})]),_:1})]),_:1}),t(D,{span:24,style:{"text-align":"right"}},{default:e(()=>[t(v,{span:24},{default:e(()=>[t(R,{flex:"","justify-end":"","w-full":""},{default:e(()=>[t(x,{loading:a(W),type:"primary",onClick:X},{default:e(()=>[u(" 查询 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modal"])]),_:1}),t(D,{gutter:24},{default:e(()=>[t(v,{span:24},{default:e(()=>[t(B,{title:"用户列表"},{extra:e(()=>[t(R,{size:24},{default:e(()=>[t(x,{type:"default",onClick:ae},{default:e(()=>[u(" 添加用户 ")]),_:1}),t(_e,{title:"列设置"},{default:e(()=>[t(de,{open:a(E),"onUpdate:open":l[8]||(l[8]=o=>Ke(E)?E.value=o:null),trigger:"click"},{overlay:e(()=>[t(B,null,{title:e(()=>[t(ie,{checked:a(c).checkAll,"onUpdate:checked":l[6]||(l[6]=o=>a(c).checkAll=o),indeterminate:a(c).indeterminate,onChange:K},{default:e(()=>[u(" 列选择 ")]),_:1},8,["checked","indeterminate"])]),extra:e(()=>[t(x,{type:"link",onClick:q},{default:e(()=>[u(" 重置 ")]),_:1})]),default:e(()=>[t(re,{value:a(c).checkList,"onUpdate:value":l[7]||(l[7]=o=>a(c).checkList=o),options:a(P),style:{display:"flex","flex-direction":"column"},onChange:Z},null,8,["value","options"])]),_:1})]),default:e(()=>[t(a(ve))]),_:1},8,["open"])]),_:1})]),_:1})]),default:e(()=>[t(pe,{loading:a(I),columns:a(w),"data-source":a(V),pagination:a(g),scroll:{x:1500}},{bodyCell:e(({column:o,record:s})=>[o.dataIndex==="status"?(i(),L(z,{key:0},[s.status==="forbidden"?(i(),_(C,{key:0,color:"purple"},{default:e(()=>[u(m(a(k).forbidden),1)]),_:1})):d("",!0),s.status==="excess"?(i(),_(C,{key:1,color:"orange"},{default:e(()=>[u(m(a(k).excess),1)]),_:1})):d("",!0),s.status==="normal"?(i(),_(C,{key:2,color:"cyan"},{default:e(()=>[u(m(a(k).normal),1)]),_:1})):d("",!0),s.status==="paid"?(i(),_(C,{key:3,color:"green"},{default:e(()=>[u(m(a(k).paid),1)]),_:1})):d("",!0),s.status==="expire"?(i(),_(C,{key:4,color:"blue"},{default:e(()=>[u(m(a(k).expire),1)]),_:1})):d("",!0),s.status==="delete"?(i(),_(C,{key:5,color:"red"},{default:e(()=>[u(m(a(k).delete),1)]),_:1})):d("",!0)],64)):d("",!0),o.dataIndex==="classExpire"?(i(),L(z,{key:1},[u(m(a(H)(s.classExpire).format("YYYY-MM-DD")),1)],64)):d("",!0),o.dataIndex==="regDate"?(i(),L(z,{key:2},[u(m(a(H)(s.regDate).format("YYYY-MM-DD HH:mm")),1)],64)):d("",!0),o.dataIndex==="action"?(i(),_(R,{key:3},{default:e(()=>[t(x,{type:"default",onClick:M=>ee(s)},{default:e(()=>[u(" 修改 ")]),_:2},1032,["onClick"]),t(x,{type:"default",onClick:M=>{Y.value=s,$.value=!0,S.value=He}},{default:e(()=>[u(" 购买记录 ")]),_:2},1032,["onClick"]),t(x,{type:"default",onClick:M=>{Y.value=s,$.value=!0,S.value=Fe}},{default:e(()=>[u(" 充值记录 ")]),_:2},1032,["onClick"]),t(ce,{title:"确定要删除用户吗？",onConfirm:M=>te(s.id)},{icon:e(()=>[t(a(ke))]),default:e(()=>[t(x,{danger:"",type:"primary"},{default:e(()=>[u(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):d("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1})]),_:1})]),_:1}),t(me,{title:"编辑用户",width:720,visible:a(y),"body-style":{paddingBottom:"80px"},onClose:l[9]||(l[9]=o=>y.value=!1)},{default:e(()=>[a(y)?(i(),_(J(Ve),{key:0,"user-id":a(A),onHandleClose:ne},null,40,["user-id"])):d("",!0)]),_:1},8,["visible"]),a($)?(i(),_(J(a(S)),{key:0,user:a(Y),onClose:l[10]||(l[10]=o=>{$.value=!1,S.value=void 0})},null,40,["user"])):d("",!0)]),_:1})}}});export{dt as default};

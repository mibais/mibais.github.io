import{P as n,_ as O,c as R,p as V,a as T}from"./index.vue_vue_type_script_setup_true_lang-BtLAqWP4.js";import{i as z}from"./index-BDJN4E4e.js";import{u as F}from"./index-D9D5W6cL.js";import{be as $,V as E,K as G,aA as J,aS as K,am as Q}from"./antd-3rLJf0bF.js";import{d as U,az as v,aA as w,s as W,f as m,w as j,a5 as g,a3 as D,k as s,ad as r,u as o,G as H,ac as I,ag as L,F as X}from"./vue-DIvP5FMT.js";const ne=U({__name:"wechat-qrcode",props:v({payPrice:{type:String,required:!0}},{payClient:{},payClientModifiers:{},open:{type:Boolean,default:!1},openModifiers:{}}),emits:v(["close"],["update:payClient","update:open"]),setup(p,{emit:h}){const u=p,k=F(),c=w(p,"payClient"),i=w(p,"open"),y=h,l=W(),d=m(""),t=m(""),f=m(!1);async function P(){const{data:e}=await T({type:n.wechat,payPrice:u.payPrice});t.value=e}async function C(){await l.value.createSse(t.value,"charge")}async function S(){f.value=!0,await P(),await C();const{data:e}=await R({type:n.wechat,payPrice:u.payPrice,tradeNo:t.value});d.value=e,z()||window.open(d.value,"_blank"),f.value=!1}function b(e){const a=JSON.parse(e);a.charge&&a.payPrice==u.payPrice&&(y("close",!0),l.value.closeSse("charge",t.value))}async function M(){const{data:e}=await V(t.value);["paid","finished"].includes(e)?(y("close",!0),l.value.closeSse("charge",t.value)):k.warning("付款尚未成功")}return j(i,()=>{i.value&&c.value===n.wechat&&S()}),(e,a)=>{const N=E,B=G,x=J,A=K,q=Q;return g(),D(X,null,[s(O,{ref_key:"sseRef",ref:l,onReceiveMsg:b},null,512),s(N,{class:"payButton",type:c.value===o(n).wechat?"primary":"default",onClick:a[0]||(a[0]=_=>c.value=o(n).wechat)},{icon:r(()=>[s(o($))]),default:r(()=>[H(" 微信 ")]),_:1},8,["type"]),c.value===o(n).wechat?(g(),I(q,{key:0,open:i.value,"onUpdate:open":a[1]||(a[1]=_=>i.value=_),"ok-text":"已支付",keyboard:!1,"mask-closable":!1,closable:!1,width:320,"cancel-button-props":{disabled:!0},title:"微信扫码支付",onOk:M},{default:r(()=>[s(B,{type:"warning",message:"移动端将自动打开微信app，付款完成后请手动切换到当前网页。支付成功后页面长时间无响应请点击已支付按钮。"}),s(A,{spinning:o(f),tip:"付款码正在加载中"},{default:r(()=>[s(x,{size:270,value:o(d)},null,8,["value"])]),_:1},8,["spinning"])]),_:1},8,["open"])):L("",!0)],64)}}});export{ne as _};

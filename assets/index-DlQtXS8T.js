import{_ as L}from"./index.vue_vue_type_script_setup_true_lang-ChuEzVa1.js";import{aI as P,V as U,d as q,N as G,O as H,aa as K,aJ as Q,aK as W,ab as X,aL as Z,m as ee,F as te,a9 as ae,an as ne,am as oe}from"./antd-DWod4DQe.js";import{_ as se}from"./detail.vue_vue_type_script_setup_true_lang-6CyWNpFn.js";import{a as ue,b as le,B as N}from"./bought-BXAemHLN.js";import{_ as ie}from"./refund.vue_vue_type_script_setup_true_lang-BtHubilW.js";import{d as V,a5 as r,ac as v,ad as e,G as p,ag as f,f as g,r as re,c as de,o as pe,k as t,u as a,a3 as w,F as I,al as _e,af as h,H as me,ak as ce,a8 as fe}from"./vue-DIvP5FMT.js";import"./index-BhAGI5mP.js";import"./context-BiCfceRa.js";import"./shop-gPStINoZ.js";const ge=V({__name:"active",props:{buttonType:{type:String,default:"primary"},danger:{type:Boolean,default:!1},message:{type:String,default:"套餐激活成功"},bought:{type:Object,required:!0}},emits:["on-active"],setup(y,{emit:_}){const C=_,b=y;async function i(){const{id:u,userid:m}=b.bought;await ue(m,u),P.success(b.message),C("on-active",!0)}return(u,m)=>{const d=U;return y.bought.status==="no_use"?(r(),v(d,{key:0,danger:y.danger,type:y.buttonType,onClick:i},{default:e(()=>[p(" 激活 ")]),_:1},8,["danger","type"])):f("",!0)}}}),ve=fe("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"购买记录管理",-1),ze=V({__name:"index",setup(y){const _=g(!1),C=g([{title:"#",dataIndex:"id"},{title:"商品名",dataIndex:"shopName"},{title:"购买日期",dataIndex:"datetime"},{title:"自动续费",dataIndex:"renew"},{title:"价格",dataIndex:"price"},{title:"状态",dataIndex:"status"},{title:"操作",dataIndex:"action"}]),b=g(),i=re({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:s=>`${s}条记录`,onChange(s,n){i.pageSize=n,i.current=s,m()}}),u=g({});async function m(){if(!_.value){_.value=!0;try{const{data:s}=await le({size:i.pageSize,current:i.current,param:u.value});b.value=s.records,i.total=s.total,i.pageSize=s.size,i.current=s.current}finally{_.value=!1}}}const d=g(!1),z=g(0);function F(s){d.value=!0,z.value=s.snapshotId}const M=de(()=>{const s={};for(const n in N)s[n]=N[n];return s});function Y(s){s&&m()}return pe(()=>{m()}),(s,n)=>{const B=G,x=H,c=K,S=Q,D=W,k=X,j=Z,$=U,O=ee,A=te,T=ae,E=ne,R=oe,J=L;return r(),v(J,null,{title:e(()=>[ve]),default:e(()=>[t(T,{"mb-4":""},{default:e(()=>[t(A,{modal:a(u)},{default:e(()=>[t(k,{gutter:16},{default:e(()=>[t(c,{span:8},{default:e(()=>[t(x,{label:"用户名",name:"userName"},{default:e(()=>[t(B,{value:a(u).userName,"onUpdate:value":n[0]||(n[0]=o=>a(u).userName=o)},null,8,["value"])]),_:1})]),_:1}),t(c,{span:8},{default:e(()=>[t(x,{label:"商品名",name:"shopName"},{default:e(()=>[t(B,{value:a(u).shopName,"onUpdate:value":n[1]||(n[1]=o=>a(u).shopName=o)},null,8,["value"])]),_:1})]),_:1}),t(c,{span:8},{default:e(()=>[t(x,{label:"购买状态",name:"boughtStatus"},{default:e(()=>[t(D,{value:a(u).boughtStatus,"onUpdate:value":n[2]||(n[2]=o=>a(u).boughtStatus=o)},{default:e(()=>[(r(!0),w(I,null,_e(a(M),(o,l)=>(r(),v(S,{key:l,value:l},{default:e(()=>[p(h(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(k,{gutter:16},{default:e(()=>[t(c,{span:8},{default:e(()=>[t(x,{label:"购买日期"},{default:e(()=>[t(j,{allowEmpty:[!0,!0],placeholder:["开始日期","结束日期"],onChange:n[3]||(n[3]=(o,l)=>{a(u).startDateTime=l[0],a(u).endDateTime=l[1]})})]),_:1})]),_:1}),t(c,{span:8},{default:e(()=>[t(x,{label:"自动续期",name:"renew"},{default:e(()=>[t(D,{value:a(u).renew,"onUpdate:value":n[4]||(n[4]=o=>a(u).renew=o),"allow-clear":!0},{default:e(()=>[t(S,{value:1},{default:e(()=>[p(" 开启 ")]),_:1}),t(S,{value:0},{default:e(()=>[p(" 关闭 ")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(k,{span:24,style:{"text-align":"right"}},{default:e(()=>[t(c,{span:24},{default:e(()=>[t(O,{flex:"","justify-end":"","w-full":""},{default:e(()=>[t($,{loading:a(_),type:"primary",onClick:m},{default:e(()=>[p(" 查询 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modal"])]),_:1}),t(k,{gutter:16},{default:e(()=>[t(c,{span:24},{default:e(()=>[t(T,{title:"购买记录"},{default:e(()=>[t(E,{loading:a(_),columns:a(C),"data-source":a(b),pagination:a(i),scroll:{x:100}},{bodyCell:e(({column:o,record:l})=>[o.dataIndex==="shopName"?(r(),v($,{key:0,type:"link",onClick:ye=>F(l)},{default:e(()=>[p(h(l.shopName),1)]),_:2},1032,["onClick"])):f("",!0),o.dataIndex==="datetime"?(r(),w(I,{key:1},[p(h(a(q)(l.datetime).format("YYYY-MM-DD")),1)],64)):f("",!0),o.dataIndex==="renew"?(r(),w(I,{key:2},[p(h(l.renew?"开启":"关闭"),1)],64)):f("",!0),o.dataIndex==="status"?(r(),w(I,{key:3},[p(h(a(N)[l.status]),1)],64)):f("",!0),o.dataIndex==="action"?(r(),v(O,{key:4},{default:e(()=>[t(ge,{bought:l},null,8,["bought"]),t(ie,{bought:l,visible:!["invalid","refund"].includes(l.status),onOnClose:Y},null,8,["bought","visible"])]),_:2},1024)):f("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1})]),_:1})]),_:1}),t(R,{open:a(d),"onUpdate:open":n[5]||(n[5]=o=>me(d)?d.value=o:null),width:"800px",title:"详情",onCancel:n[6]||(n[6]=o=>d.value=!1),onOk:n[7]||(n[7]=o=>d.value=!1)},{default:e(()=>[a(d)?(r(),v(ce(se),{key:0,"snapshot-id":a(z)},null,8,["snapshot-id"])):f("",!0)]),_:1},8,["open"])]),_:1})}}});export{ze as default};

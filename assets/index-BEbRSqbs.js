import{_ as E}from"./index.vue_vue_type_script_setup_true_lang-v5USCKFQ.js";import{S as B,aw as G,b0 as H,d as Y,b1 as J,b2 as P,a9 as K,aa as L,ab as W,m as X,an as Z,am as ee}from"./antd-CrhK6lnF.js";import{B as p,d as te,e as ae,r as ne}from"./bought-CTmUsAuF.js";import{_ as oe}from"./detail.vue_vue_type_script_setup_true_lang-D8xmPCB4.js";import{_ as se}from"./refund.vue_vue_type_script_setup_true_lang-ClyYG7e4.js";import{u as ie,a as ue,_ as le}from"./index-CB972hdw.js";import{d as N,ab as de,a5 as r,ac as g,ad as e,k as t,u as a,G as m,af as y,ag as _,f as w,r as ce,o as re,a3 as $,F as z,H as _e,ak as pe,a6 as me,a7 as fe,a8 as h}from"./vue-DIvP5FMT.js";import"./context-CaHszqCF.js";import"./shop-Dptp6kgK.js";const ge=N({__name:"auto_renew",props:{bought:{type:Object,required:!0},buttonType:{type:String,default:"default"},closeMessage:{type:String,default:"关闭成功 👋"},openMessage:{type:String,default:"开启成功 🎉"}},emits:["on-change"],setup(i,{emit:l}){const x=l,s=i;async function v(){await te({boughtId:s.bought.id,userId:s.bought.userid}),ie().success(s.bought.renew?s.closeMessage:s.openMessage),x("on-change",!s.bought.renew)}return(S,I)=>{const u=de("QuestionCircleOutlined"),f=B,C=G;return r(),g(C,{title:`确定要${i.bought.renew?"关闭":"开启"}？`,onConfirm:v},{icon:e(()=>[t(u)]),default:e(()=>[[a(p).using,a(p).no_use].includes(a(p)[i.bought.status])?(r(),g(f,{key:0,type:i.buttonType},{default:e(()=>[m(y(`${i.bought.renew?"关闭":"开启"}自动续费`),1)]),_:1},8,["type"])):_("",!0)]),_:1},8,["title"])}}}),b=i=>(me("data-v-7f401aef"),i=i(),fe(),i),he=b(()=>h("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"购买记录",-1)),we=b(()=>h("p",null,"新买的套餐只能等当前套餐结束后才会自动使用。如果想要充值流量，请前往在线商店页点击右上角购买流量包按钮充值流量；如果想要更换套餐，请退款当前正在使用的套餐，系统会自动激活未使用的套餐。",-1)),ye=b(()=>h("p",null,"手机等因小屏幕无法看到退款的，请切换至横屏浏览，或者更换平板、电脑等大屏幕。",-1)),be=b(()=>h("p",null,"购买记录自失效后保留7天。失效指退款、过期等无效状态。",-1)),xe=b(()=>h("p",null,[m("退款的款项只回到账户"),h("a",{href:"code"},"钱包"),m("中，无法原路退款到付款方")],-1)),Se=N({__name:"index",setup(i){const l=w(!1),x=w(0),s=w(!1),v=[{title:"商品名",dataIndex:"shopName",width:120},{title:"价格",dataIndex:"price",width:40},{title:"购买时间",dataIndex:"datetime",width:40},{title:"状态",dataIndex:"status",width:40},{title:"续费时间",dataIndex:"renewTime",width:80},{title:"操作",dataIndex:"action",width:120}],S=w([]),I=w(),u=ce({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:n=>`${n}条记录`,onChange(n,d){u.pageSize=d,u.current=n,f()}});async function f(){if(!s.value){s.value=!0;try{const{data:n}=await ae({size:u.pageSize,current:u.current});S.value=n.records,u.total=n.total,u.pageSize=n.size,u.current=n.current}finally{s.value=!1}}}async function C(n){l.value=!0,x.value=n.snapshotId}async function R(){const{data:n}=await ne();I.value=n}async function A(n){n&&(await f(),await ue().getUserInfo())}return re(()=>{f(),R()}),(n,d)=>{const k=J,V=P,D=K,O=L,T=W,Q=B,U=X,j=Z,F=ee,q=E;return r(),g(q,null,{title:e(()=>[he]),default:e(()=>[t(T,{gutter:24},{default:e(()=>[t(O,{span:24},{default:e(()=>[t(D,{title:"提示"},{default:e(()=>[t(V,{bordered:!1,ghost:""},{expandIcon:e(o=>[t(a(H),{rotate:o!=null&&o.isActive?90:0},null,8,["rotate"])]),default:e(()=>[t(k,{key:"1",header:"购买的套餐未生效",class:"triangle"},{default:e(()=>[we]),_:1}),t(k,{key:"2",header:"没有看到退款按钮",class:"triangle"},{default:e(()=>[ye]),_:1}),t(k,{key:"3",header:"购买记录保留几天",class:"triangle"},{default:e(()=>[be]),_:1}),t(k,{key:"4",header:"退款去向",class:"triangle"},{default:e(()=>[xe]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(T,{gutter:24,"mt-5":""},{default:e(()=>[t(O,{span:24},{default:e(()=>[t(D,{title:"购买明细"},{default:e(()=>[t(j,{loading:a(s),columns:v,"data-source":a(S),pagination:a(u)},{bodyCell:e(({column:o,record:c})=>[o.dataIndex==="shopName"?(r(),g(Q,{key:0,type:"link",onClick:M=>C(c)},{default:e(()=>[m(y(c.shopName),1)]),_:2},1032,["onClick"])):_("",!0),o.dataIndex==="status"?(r(),$(z,{key:1},[m(y(a(p)[c.status]),1)],64)):_("",!0),o.dataIndex==="datetime"?(r(),$(z,{key:2},[m(y(a(Y)(c.datetime).format("YYYY-MM-DD")),1)],64)):_("",!0),o.dataIndex==="renewTime"?(r(),$(z,{key:3},[m(y(c.renewTime?a(Y)(c.renewTime).format("YYYY-MM-DD"):"不自动续费"),1)],64)):_("",!0),o.dataIndex==="action"?(r(),g(U,{key:4},{default:e(()=>{var M;return[t(ge,{bought:c,onOnChange:f},null,8,["bought"]),t(se,{danger:"",visible:((M=a(I))==null?void 0:M.allowRefund)&&[a(p).using,a(p).no_use].includes(a(p)[c.status]),bought:c,onOnClose:A},null,8,["visible","bought"])]}),_:2},1024)):_("",!0)]),_:1},8,["loading","data-source","pagination"])]),_:1})]),_:1})]),_:1}),t(F,{open:a(l),"onUpdate:open":d[0]||(d[0]=o=>_e(l)?l.value=o:null),width:"800px",title:"详情",onCancel:d[1]||(d[1]=o=>l.value=!1),onOk:d[2]||(d[2]=o=>l.value=!1)},{default:e(()=>[a(l)?(r(),g(pe(oe),{key:0,"snapshot-id":a(x)},null,8,["snapshot-id"])):_("",!0)]),_:1},8,["open"])]),_:1})}}}),Te=le(Se,[["__scopeId","data-v-7f401aef"]]);export{Te as default};

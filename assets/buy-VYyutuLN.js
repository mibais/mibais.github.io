import{_ as Z}from"./coupon.vue_vue_type_script_setup_true_lang-adkAvngl.js";import{v as ee,h as te}from"./shop-BKFAyQOl.js";import{P as ne}from"./alipay-qrcode.vue_vue_type_script_setup_true_lang-CHAobjZk.js";import{p as ae}from"./paymentMap-BCv1C10o.js";import{d as W,a5 as i,a3 as w,k as t,ad as e,U as D,a8 as f,af as d,F as R,aq as oe,f as _,c as A,w as se,ac as S,G as u,u as n,ag as le,al as L,ak as ue,H as O,a6 as pe,a7 as ie}from"./vue-DIvP5FMT.js";import{az as re,ab as ce,aa as _e,b3 as de,b4 as me,b5 as fe,b6 as ye,b7 as ve,ar as be,S as ge,J as Ce,m as we,aS as ke,ao as xe,aM as he,aN as Pe,am as Se}from"./antd-CrhK6lnF.js";import{a as $e,u as Ie,_ as Te}from"./index-d7i-9Cua.js";const Be={class:"text-muted"},$=W({__name:"title-button",props:{help:{type:String,default:""}},setup(r){return(y,I)=>{const v=re,k=ce,b=_e;return i(),w(R,null,[t(k,{"mt-5":""},{default:e(()=>[t(v,{level:5},{default:e(()=>[D(y.$slots,"titlePrefix"),D(y.$slots,"title")]),_:3})]),_:3}),t(k,{"mt-2":""},{default:e(()=>[t(b,null,{default:e(()=>[D(y.$slots,"default")]),_:3}),t(b,{span:24},{default:e(()=>[f("p",Be,d(r.help),1)]),_:1})]),_:3})],64)}}}),Ne=r=>(pe("data-v-d9803ac6"),r=r(),ie(),r),ze=Ne(()=>f("ul",null,[f("li",null,"购买会员计划即代表同意《服务条款》和《使用政策》"),f("li",null,"如果购买套餐后遇到使用问题，请点击网页右下角联系在线客服")],-1)),Fe={key:0},Me={key:1},De=W({__name:"buy",props:{coverId:{type:Number,required:!0},open:{type:Boolean,required:!0}},emits:["update:open","buyTrafficPackage"],setup(r,{emit:y}){const I=r,v=y,k=oe(),b=_(""),m=_(-1),l=_(),U=_(!0),g=_(!1),T=_(ne.alipay),B=_(),x=$e(),V=Ie(),N={color:"#FF7200",fontWeight:"bold"};async function E(){var a;const{data:p}=await ee(I.coverId);B.value=p,U.value=!1,l.value=(a=B.value)==null?void 0:a.shopList[0]}const G=A(()=>{var a,P;if(!l.value)return null;const p=m.value>=0?m.value:(a=l.value)==null?void 0:a.price;return x.userInfo.money>=p?p:(P=x.userInfo)==null?void 0:P.money}),z=A(()=>{var a;const p=m.value>=0?m.value:(a=l.value)==null?void 0:a.price;return Math.max(0,p-G.value).toFixed(2)}),h=_(!1);async function H(){if(z.value<=0)return q();h.value=!0}async function J(p){p&&await q()}async function q(){if(!l.value)return V.error("请选择套餐时长");await te({coupon:b.value,shopId:l.value.id,autoRenew:g.value}),V.success("购买成功o(*￣▽￣*)ブ"),await k.push({path:"/bought/pay-success",replace:!0})}return se(()=>I.open,p=>p&&E()),(p,a)=>{const P=be,C=ge,j=Ce,F=we,K=ke,Q=xe,M=he,X=Pe,Y=Se;return i(),S(Y,{width:"700px",title:"选择套餐",open:r.open,onCancel:a[6]||(a[6]=o=>v("update:open",!1))},{footer:e(()=>[t(P,null,{default:e(()=>[u("还需支付 "),f("span",{style:N},d(n(z))+"元",1)]),_:1}),t(C,{"ml-3":"",key:"submit",type:"primary",onClick:H},{default:e(()=>[u("购买")]),_:1})]),default:e(()=>[["excess","paid"].includes(n(x).userInfo.status)?(i(),S(j,{key:0,message:"请注意",type:"warning","close-text":"知道了","show-icon":""},{description:e(()=>[u(" 你有套餐正在使用中，购买的套餐将不会立即生效。如果你只是想充值流量，请 "),t(C,{type:"link",size:"small",onClick:a[0]||(a[0]=o=>{v("update:open",!1),v("buyTrafficPackage")})},{icon:e(()=>[t(n(de))]),default:e(()=>[u(" 点我 ")]),_:1})]),_:1})):le("",!0),t($,null,{title:e(()=>[u(" 选择时长")]),titlePrefix:e(()=>[t(n(me),{"two-tone-color":"#eb2f96",closable:""})]),default:e(()=>[t(K,{spinning:n(U)},{default:e(()=>[t(F,{size:[24,16],wrap:""},{default:e(()=>{var o;return[(i(!0),w(R,null,L((o=n(B))==null?void 0:o.shopList,s=>{var c;return i(),S(C,{key:s.id,type:((c=n(l))==null?void 0:c.id)===s.id?"primary":"default",class:"buyButton",onClick:Re=>l.value=s},{default:e(()=>[u(d(s.content.expire===0?"长期":`${s.content.expire}天`),1)]),_:2},1032,["type","onClick"])}),128))]}),_:1})]),_:1},8,["spinning"])]),_:1}),t($,{help:"* 如开启自动续费，请确保账号余额充足"},{title:e(()=>[u(" 自动续费")]),titlePrefix:e(()=>[t(n(fe),{"two-tone-color":"#52c41a"})]),default:e(()=>[t(F,{size:16},{default:e(()=>{var o,s;return[t(C,{disabled:((o=n(l))==null?void 0:o.content.expire)===0,class:"buyButton",type:n(g)?"primary":"default",onClick:a[1]||(a[1]=c=>g.value=!0)},{default:e(()=>[u(" 开启 ")]),_:1},8,["disabled","type"]),t(C,{disabled:((s=n(l))==null?void 0:s.content.expire)===0,class:"buyButton",type:n(g)?"default":"primary",onClick:a[2]||(a[2]=c=>g.value=!1)},{default:e(()=>[u(" 关闭 ")]),_:1},8,["disabled","type"])]}),_:1})]),_:1}),t($,{help:"* 默认抵扣账户余额"},{title:e(()=>[u(" 支付方式")]),titlePrefix:e(()=>[t(n(ye))]),default:e(()=>[t(F,{size:20},{default:e(()=>[(i(!0),w(R,null,L(n(ae),(o,s)=>(i(),S(ue(o),{key:s,payClient:n(T),"onUpdate:payClient":a[3]||(a[3]=c=>O(T)?T.value=c:null),open:n(h),"onUpdate:open":a[4]||(a[4]=c=>O(h)?h.value=c:null),payPrice:n(z),onClose:J},null,40,["payClient","open","payPrice"]))),128))]),_:1})]),_:1}),t($,null,{title:e(()=>[u(" 购买须知")]),titlePrefix:e(()=>[t(n(ve))]),default:e(()=>[t(Q,null,{default:e(()=>[ze]),_:1})]),_:1}),t(X,{"mb-8":"",bordered:"",title:"支付明细"},{extra:e(()=>{var o;return[t(Z,{"shop-id":(o=n(l))==null?void 0:o.id,onApplyCoupon:a[5]||(a[5]=s=>{b.value=s.couponCode,m.value=s.discountedPrice})},null,8,["shop-id"])]}),default:e(()=>[t(M,{label:"套餐名称","content-style":{fontWeight:"bold"},span:3},{default:e(()=>{var o;return[u(d((o=n(l))==null?void 0:o.name),1)]}),_:1}),t(M,{"content-style":N,label:"套餐总价"},{default:e(()=>{var o,s;return[n(m)>=0?(i(),w("span",Fe,[u(d(n(m))+"元 ",1),f("del",null,d((o=n(l))==null?void 0:o.price)+"元",1)])):(i(),w("span",Me,d((s=n(l))==null?void 0:s.price)+"元 ",1))]}),_:1}),t(M,{"content-style":N,label:"账户余额"},{default:e(()=>{var o;return[u(d((o=n(x).userInfo)==null?void 0:o.money)+"元",1)]}),_:1})]),_:1})]),_:1},8,["open"])}}}),Ee=Te(De,[["__scopeId","data-v-d9803ac6"]]);export{Ee as default};

import{P as n,_ as O,c as R,p as V,a as T}from"./index.vue_vue_type_script_setup_true_lang-CaS2_JM4.js";import{u as z}from"./index-BlNNMF3U.js";import{be as F,V as $,K as E,aA as G,aS as J,am as K}from"./antd-D-bStUmV.js";import{d as Q,az as v,aA as g,s as U,f,w as W,a5 as w,a3 as j,k as s,ad as r,u as o,G as D,ac as H,ag as I,F as L}from"./vue-BVKynzoK.js";const ae=Q({__name:"wechat-qrcode",props:v({payPrice:{type:String,required:!0}},{payClient:{},payClientModifiers:{},open:{type:Boolean,default:!1},openModifiers:{}}),emits:v(["close"],["update:payClient","update:open"]),setup(p,{emit:h}){const u=p,k=z(),c=g(p,"payClient"),l=g(p,"open"),y=h,i=U(),m=f(""),t=f(""),d=f(!1);async function P(){const{data:e}=await T({type:n.wechat,payPrice:u.payPrice});t.value=e}async function C(){await i.value.createSse(t.value,"charge")}async function S(){d.value=!0,await P(),await C();const{data:e}=await R({type:n.wechat,payPrice:u.payPrice,tradeNo:t.value});m.value=e,d.value=!1}function M(e){const a=JSON.parse(e);a.charge&&a.payPrice==u.payPrice&&(y("close",!0),i.value.closeSse("charge",t.value))}async function b(){const{data:e}=await V(t.value);["paid","finished"].includes(e)?(y("close",!0),i.value.closeSse("charge",t.value)):k.warning("付款尚未成功")}return W(l,()=>{l.value&&c.value===n.wechat&&S()}),(e,a)=>{const N=$,B=E,x=G,A=J,q=K;return w(),j(L,null,[s(O,{ref_key:"sseRef",ref:i,onReceiveMsg:M},null,512),s(N,{class:"payButton",type:c.value===o(n).wechat?"primary":"default",onClick:a[0]||(a[0]=_=>c.value=o(n).wechat)},{icon:r(()=>[s(o(F))]),default:r(()=>[D(" 微信 ")]),_:1},8,["type"]),c.value===o(n).wechat?(w(),H(q,{key:0,open:l.value,"onUpdate:open":a[1]||(a[1]=_=>l.value=_),"ok-text":"已支付",keyboard:!1,"mask-closable":!1,closable:!1,width:320,"cancel-button-props":{disabled:!0},title:"微信扫码支付",onOk:b},{default:r(()=>[s(B,{type:"warning",message:"支付成功后页面长时间无响应请点击已支付按钮。"}),s(A,{spinning:o(d),tip:"付款码正在加载中"},{default:r(()=>[s(x,{size:270,value:o(m)},null,8,["value"])]),_:1},8,["spinning"])]),_:1},8,["open"])):I("",!0)],64)}}});export{ae as _};

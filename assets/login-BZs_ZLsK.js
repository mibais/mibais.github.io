var ie=Object.defineProperty;var re=(s,o,a)=>o in s?ie(s,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[o]=a;var f=(s,o,a)=>(re(s,typeof o!="symbol"?o+"":o,a),a);import{_ as ce}from"./index.vue_vue_type_script_setup_true_lang-Da0GWLkT.js";import{_ as le,a as pe,b as ue}from"./login-left-q9yaNWl9.js";import{f as $,d as de,g as A,e as me,h as E,A as _e,_ as he,j as ge}from"./index-DfSpHaIU.js";import{g as w}from"./tools-lFUf1Wg_.js";import{t as I}from"./third-part-fnhvkpeN.js";import{d as k,W as fe,r as ve,s as M,f as F,ap as we,o as S,u as e,j as be,a3 as q,a8 as i,af as v,ac as P,k as r,ad as m,aq as z,a5 as h,ag as ye,G as U,a6 as xe,a7 as ke,ak as Ce}from"./vue-DIvP5FMT.js";import{B as Le,F as Ie,E as Me,G as Pe,H as $e,I as Ae,J as Ee,y as Se,T as qe,K as ze,N as Ge,O as Te,Q as Be,S as Ue,V as Oe}from"./antd-DWod4DQe.js";var Re=async(s=0)=>new Promise(o=>{const a=setTimeout(()=>{o(!0),clearTimeout(a)},s)});const We="https://asset.mebi.me:8012/logo.png",t={width:0,height:0,canvas:null,ctx:null,circles:[],animate:!0,requestId:null},Ne=function(s){if(!t||!s)throw new Error("no canvasInstance");t.width=window.innerWidth,t.height=window.innerHeight,t.canvas=s,t.canvas.width=t.width,t.canvas.height=t.height,t.ctx=t.canvas.getContext("2d"),t.circles=[];for(let o=0;o<t.width*.5;o++){const a=new Ve;t.circles.push(a)}D(),je()};function H(){t.animate=!(document.body.scrollTop>t.height)}function K(){t.width=window.innerWidth,t.height=window.innerHeight,t.canvas.width=t.width,t.canvas.height=t.height}function D(){if(t.animate){t.ctx.clearRect(0,0,t.width,t.height);for(const s in t.circles)t.circles[s].draw()}t.requestId=requestAnimationFrame(D)}class Ve{constructor(){f(this,"pos");f(this,"alpha");f(this,"scale");f(this,"velocity");f(this,"draw");this.pos={x:Math.random()*t.width,y:t.height+Math.random()*100},this.alpha=.1+Math.random()*.3,this.scale=.1+Math.random()*.3,this.velocity=Math.random();const o=Math.random()*255,a=Math.random()*255,u=Math.random()*255;this.draw=function(){this.pos.y-=this.velocity,this.alpha-=5e-4,t.ctx.beginPath(),t.ctx.arc(this.pos.x,this.pos.y,this.scale*10,0,2*Math.PI,!1),t.ctx.fillStyle=`rgba(${o},${a},${u},${this.alpha})`,t.ctx.fill()}}}function je(){window.addEventListener("scroll",H),window.addEventListener("resize",K)}function Fe(){window.removeEventListener("scroll",H),window.removeEventListener("resize",K),cancelAnimationFrame(t.requestId)}const V={init:Ne,removeListeners:Fe},O=s=>(xe("data-v-47655802"),s=s(),ke(),s),He={class:"login-container"},Ke={"h-screen":"","w-screen":"",absolute:"","z-10":""},De={class:"login-content flex-center"},Qe={class:"ant-pro-form-login-main rounded"},Je={class:"flex-between h-15 px-4 mb-[2px]"},Xe={class:"flex-end"},Ye=O(()=>i("span",{class:"ant-pro-form-login-logo"},[i("img",{"w-full":"","h-full":"","object-cover":"",src:We})],-1)),Ze=O(()=>i("span",{class:"ant-pro-form-login-title"}," 米白云 ",-1)),et={class:"ant-pro-form-login-desc"},tt={class:"login-lang flex-center relative z-11"},ot={class:"box-border flex min-h-[520px]"},nt=O(()=>i("div",{class:"ant-pro-form-login-main-left min-h-[520px] flex-center bg-[var(--bg-color-container)]"},[i("img",{src:le,class:"h-5/6 w-5/6"})],-1)),st={class:"ant-pro-form-login-main-right px-5 w-[335px] flex-center flex-col relative z-11"},at={class:"text-center py-6 text-2xl"},it={class:"mb-24px flex-between"},rt={href:"/forget"},ct={class:"text-slate-500"},lt={class:"ant-pro-form-login-other"},pt=60,ut=k({__name:"login-sys",setup(s){const o=$(),a=de(),{layoutSetting:u}=fe(a),d=z(),l=A(),n=ve({email:void 0,password:void 0,mobile:void 0,code:void 0,type:"account",remember:!0}),{t:c}=me(),b=M(),y=M(!1),C=M(!1),L=F(),{pause:Q}=we(1e3,{controls:!0,immediate:!1,callback(g){g&&g===pt&&Q()}});function J(){window.location.href=I.getGithubLoginUrl()}function X(){window.location.href=I.getAliLoginUrl()}function Y(){window.location.href=I.getGoogleLoginUrl()}async function G(){var g;y.value=!0;try{await((g=b.value)==null?void 0:g.validate());const p={email:n.email,password:n.password,type:"sys"},{data:x}=await E(p);l.value=x==null?void 0:x.token,o.success({message:"登录成功",description:"欢迎回来！",duration:3});const T=w("redirect","/");await d.push({path:T,replace:!0})}catch(p){p instanceof _e&&(C.value=!0),y.value=!1}}return S(async()=>{await Re(300),V.init(e(L))}),be(()=>{V.removeListeners()}),(g,p)=>{const x=pe,T=ue,Z=ce,B=Le,R=Se,ee=qe,te=ze,oe=Ge,W=Te,ne=Be,se=Ue,N=Oe,ae=Ie;return h(),q("div",He,[i("div",Ke,[i("canvas",{ref_key:"bubbleCanvas",ref:L},null,512)]),i("div",De,[i("div",Qe,[i("div",Je,[i("div",Xe,[Ye,Ze,i("span",et,v(e(c)("pages.layouts.userLayout.title")),1)]),i("div",tt,[i("span",{class:"flex-center cursor-pointer text-16px",onClick:p[0]||(p[0]=_=>e(a).toggleTheme(e(u).theme==="dark"?"light":"dark"))},[e(u).theme==="light"?(h(),P(x,{key:0})):(h(),P(T,{key:1}))]),r(Z)])]),r(B,{"m-0":""}),i("div",ot,[nt,r(B,{"m-0":"",type:"vertical",class:"ant-pro-login-divider min-h-[520px]"}),i("div",st,[i("div",at,v(e(c)("pages.login.tips")),1),r(ae,{ref_key:"formRef",ref:b,model:e(n)},{default:m(()=>[r(ee,{activeKey:e(n).type,"onUpdate:activeKey":p[1]||(p[1]=_=>e(n).type=_),centered:""},{default:m(()=>[r(R,{key:"account",tab:e(c)("pages.login.accountLogin.tab")},null,8,["tab"]),r(R,{key:"mobile",disabled:"",tab:e(c)("pages.login.phoneLogin.tab")},null,8,["tab"])]),_:1},8,["activeKey"]),e(C)?(h(),P(te,{key:0,"mb-24px":"",message:e(c)("pages.login.accountLogin.errorMessage"),type:"error","show-icon":""},null,8,["message"])):ye("",!0),r(W,{name:"email",rules:[{required:!0,message:e(c)("pages.login.email.required")}]},{default:m(()=>[r(oe,{value:e(n).email,"onUpdate:value":p[2]||(p[2]=_=>e(n).email=_),"allow-clear":"",autocomplete:"off",placeholder:e(c)("pages.login.email.placeholder"),size:"large",onPressEnter:G},{prefix:m(()=>[r(e(Me))]),_:1},8,["value","placeholder"])]),_:1},8,["rules"]),r(W,{name:"password",rules:[{required:!0,message:e(c)("pages.login.password.required")}]},{default:m(()=>[r(ne,{value:e(n).password,"onUpdate:value":p[3]||(p[3]=_=>e(n).password=_),"allow-clear":"",placeholder:e(c)("pages.login.password.placeholder"),size:"large",onPressEnter:G},{prefix:m(()=>[r(e(Pe))]),_:1},8,["value","placeholder"])]),_:1},8,["rules"]),i("div",it,[r(se,{checked:e(n).remember,"onUpdate:checked":p[4]||(p[4]=_=>e(n).remember=_)},{default:m(()=>[U(v(e(c)("pages.login.rememberMe")),1)]),_:1},8,["checked"]),i("a",rt,v(e(c)("pages.login.forgotPassword")),1)]),r(N,{type:"primary",block:"",loading:e(y),size:"large",onClick:G},{default:m(()=>[U(v(e(c)("pages.login.submit")),1)]),_:1},8,["loading"]),r(N,{"mt-5":"",block:"",href:"/register"},{default:m(()=>[U(" 没有账号？去注册 ")]),_:1})]),_:1},8,["model"]),r(B,null,{default:m(()=>[i("span",ct,v(e(c)("pages.login.loginWith")),1)]),_:1}),i("div",lt,[r(e($e),{class:"icon",onClick:J}),r(e(Ae),{disabled:"",class:"icon",onClick:X}),r(e(Ee),{disabled:"",class:"icon",onClick:Y})])])])])])])}}}),j=he(ut,[["__scopeId","data-v-47655802"]]),dt=k({__name:"login-github",setup(s){const o=A(),a=z(),u=$();async function d(){const{data:l}=await E({type:"github",clientId:I.getGithubClientId(),code:w("code")});o.value=l==null?void 0:l.token,u.success({message:"登录成功",description:"欢迎回来！",duration:3});const n=w("redirect","/");a.push({path:n,replace:!0})}return S(()=>{d()}),(l,n)=>(h(),q("div"))}}),mt=k({__name:"login-alipay",setup(s){const o=A(),a=z(),u=$();async function d(){const{data:l}=await E({type:"alipay",code:w("auth_code")});o.value=l==null?void 0:l.token,u.success({message:"登录成功",description:"欢迎回来！",duration:3});const n=w("redirect","/");a.push({path:n,replace:!0})}return S(()=>{d()}),(l,n)=>(h(),q("div"))}}),_t=k({__name:"login-google",props:{hashParams:{type:Object,required:!0}},setup(s){const o=s,a=A(),u=z(),d=$();async function l(){const{data:n}=await E({type:"google",code:o.hashParams.access_token});a.value=n==null?void 0:n.token,d.success({message:"登录成功",description:"欢迎回来！",duration:3}),u.push({path:"/",replace:!0})}return S(()=>{l()}),(n,c)=>(h(),q("div"))}}),kt=k({__name:"login",setup(s){const o=M(),a={sys:j,github:dt,alipay:mt,google:_t},u=F(l());let d=w("type");d||(d=u.value.state??""),o.value=a[d]??j;function l(){const c=ge.currentRoute.value.hash.substring(1).split("&"),b={};return c.forEach(y=>{const[C,L]=y.split("=");b[C]=L}),b}return(n,c)=>(h(),P(Ce(e(o)),{"hash-params":e(u)},null,8,["hash-params"]))}});export{kt as default};

import{h as A,j as B}from"./shop-bpV5_9aS.js";import{u as N}from"./index-DfSpHaIU.js";import{bc as R,aF as O,V,aw as q,N as D,O as M,F as T,am as U}from"./antd-DWod4DQe.js";import{d as $,f as m,s as j,w as E,a5 as f,a3 as G,u,ac as C,ad as o,k as a,G as r,af as H,H as S,F as z}from"./vue-DIvP5FMT.js";const W=$({__name:"coupon",props:{shopId:{type:Number,require:!0}},emits:["applyCoupon"],setup(y,{expose:k,emit:w}){const l=y,d=w,t=m({coupon:""}),_=j(),s=m(!1),n=m({couponCode:"",discountedPrice:-1});async function g(){_.value.validate().then(async()=>{const{data:c}=await A(t.value.coupon,l.shopId);n.value={couponCode:t.value.coupon,discountedPrice:c};const e=N();d("applyCoupon",n.value),e.success("优惠码使用成功 😄",3),s.value=!1})}async function v(){const{data:c}=await B(t.value.coupon,l.shopId);n.value.discountedPrice=c,d("applyCoupon",n.value)}function h(){t.value.coupon="",n.value.discountedPrice=-1,d("applyCoupon",n.value)}return E(()=>l.shopId,()=>{n.value.couponCode&&v()}),k({coupon:t.value.coupon,shopId:l.shopId,sliceApplyCoupon:v}),(c,e)=>{const i=V,I=q,x=D,F=M,P=T,b=U;return f(),G(z,null,[u(n).discountedPrice<0?(f(),C(i,{key:0,onClick:e[0]||(e[0]=p=>s.value=!0)},{icon:o(()=>[a(u(R))]),default:o(()=>[r(" 使用优惠码 ")]),_:1})):(f(),C(I,{key:1,title:"确定要取消使用优惠码？",onConfirm:h},{default:o(()=>[a(i,{type:"dashed"},{icon:o(()=>[a(u(O))]),default:o(()=>[r(" "+H(u(n).couponCode),1)]),_:1})]),_:1})),a(b,{open:u(s),"onUpdate:open":e[3]||(e[3]=p=>S(s)?s.value=p:null),closable:!1,title:"使用优惠码",width:400},{footer:o(()=>[a(i,{type:"primary",onClick:g},{default:o(()=>[r("使用")]),_:1}),a(i,{onClick:e[1]||(e[1]=p=>s.value=!1)},{default:o(()=>[r("取消")]),_:1})]),default:o(()=>[a(P,{ref_key:"formRef",ref:_,model:u(t)},{default:o(()=>[a(F,{name:"coupon",rules:[{required:!0,message:"请输入优惠码"}]},{default:o(()=>[a(x,{value:u(t).coupon,"onUpdate:value":e[2]||(e[2]=p=>u(t).coupon=p)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])],64)}}});export{W as _};

import{_ as oe}from"./coupon.vue_vue_type_script_setup_true_lang-BsMfI_S-.js";import{v as le,h as se,i as ue}from"./shop-HJQcX4a9.js";import{P as ie}from"./index.vue_vue_type_script_setup_true_lang-Bz4VQyfs.js";import{p as pe}from"./paymentMap-D2D-vfJv.js";import{d as E,a5 as r,a3 as x,k as t,ad as e,U as D,a8 as v,af as f,F,ar as re,f as p,c as O,w as W,ac as T,G as u,u as i,ag as ce,al as j,ak as de,a6 as _e,a7 as fe}from"./vue-BVKynzoK.js";import{az as me,ab as ye,aa as ve,b5 as be,b6 as ge,b7 as Ce,b8 as we,b9 as ke,ba as xe,ar as Pe,V as he,K as Se,bb as $e,m as Te,aS as Be,ao as Ie,aM as Ae,aN as Ve,am as ze}from"./antd-9nlSCyVV.js";import{a as Ne,u as De,j as Fe}from"./index-CosWhGyj.js";import"./alipay-qrcode.vue_vue_type_script_setup_true_lang-Ct6N9OTd.js";import"./wechat-qrcode.vue_vue_type_script_setup_true_lang-Dc_3iw_r.js";const Me={class:"text-muted"},k=E({__name:"title-button",props:{help:{type:String,default:""}},setup(c){return(b,B)=>{const g=me,P=ye,y=ve;return r(),x(F,null,[t(P,{"mt-5":""},{default:e(()=>[t(g,{level:5},{default:e(()=>[D(b.$slots,"titlePrefix"),D(b.$slots,"title")]),_:3})]),_:3}),t(P,{"mt-2":""},{default:e(()=>[t(y,null,{default:e(()=>[D(b.$slots,"default")]),_:3}),t(y,{span:24},{default:e(()=>[v("p",Me,f(c.help),1)]),_:1})]),_:3})],64)}}}),Re=c=>(_e("data-v-7482c835"),c=c(),fe(),c),Ue=Re(()=>v("ul",null,[v("li",null,"购买会员计划即代表同意《服务条款》和《使用政策》"),v("li",null,"如果购买套餐后遇到使用问题，请点击网页右下角联系在线客服")],-1)),qe={key:0},Le={key:1},Oe=E({__name:"buy",props:{coverId:{type:Number,required:!0},open:{type:Boolean,required:!0}},emits:["update:open","buyTrafficPackage"],setup(c,{emit:b}){const B=c,g=b,P=re(),y=p(""),d=p(-1),o=p(),M=p(!0),C=p(!1),w=p(!1),R=p(ie.alipay),I=p(),h=Ne(),U=De(),A={color:"#FF7200",fontWeight:"bold"},q={90:{discount:97,code:"quarter_off3"},180:{discount:95,code:"halfyear_off5"},360:{discount:90,code:"year_off10"}};async function G(){var n;const{data:l}=await le(B.coverId);I.value=l,M.value=!1,o.value=(n=I.value)==null?void 0:n.shopList[0]}async function K(){var n;const l=q[(n=o.value)==null?void 0:n.content.expire.toString()];l&&(d.value=(await se(l.code,o.value.id)).data,y.value=l.code)}const H=O(()=>{var n,S;if(!o.value)return null;const l=d.value>=0?d.value:(n=o.value)==null?void 0:n.price;return h.userInfo.money>=l?l:(S=h.userInfo)==null?void 0:S.money}),V=O(()=>{var n;const l=d.value>=0?d.value:(n=o.value)==null?void 0:n.price;return Math.max(0,l-H.value).toFixed(2)}),z=p(!1);async function J(){if(V.value<=0)return L();z.value=!0}async function Q(l){l&&await L()}async function L(){if(!o.value)return U.error("请选择套餐时长");await ue({coupon:y.value,shopId:o.value.id,autoRenew:C.value,instanceActive:w.value}),U.success("购买成功o(*￣▽￣*)ブ"),await P.push({path:"/bought/pay-success",replace:!0})}W(()=>B.open,l=>l&&G()),W(o,()=>K());function X(l){const n=q[l.content.expire.toString()];return n?n.discount+"折":"0"}return(l,n)=>{const S=Pe,m=he,Y=Se,Z=$e,$=Te,ee=Be,te=Ie,N=Ae,ne=Ve,ae=ze;return r(),T(ae,{width:"700px",title:"选择套餐",open:c.open,onCancel:n[8]||(n[8]=a=>g("update:open",!1))},{footer:e(()=>[t(S,null,{default:e(()=>[u("还需支付 "),v("span",{style:A},f(i(V))+"元",1)]),_:1}),t(m,{"ml-3":"",key:"submit",type:"primary",onClick:J},{default:e(()=>[u("购买")]),_:1})]),default:e(()=>[["excess","paid"].includes(i(h).userInfo.status)?(r(),T(Y,{key:0,message:"请注意",type:"warning","show-icon":""},{description:e(()=>[u(" 你有套餐正在使用中，如果你想要充值流量请 "),t(m,{type:"link",size:"small",onClick:n[0]||(n[0]=a=>{g("update:open",!1),g("buyTrafficPackage")})},{icon:e(()=>[t(i(be))]),default:e(()=>[u(" 点我 ")]),_:1})]),_:1})):ce("",!0),t(k,null,{title:e(()=>[u(" 选择时长")]),titlePrefix:e(()=>[t(i(ge),{"two-tone-color":"#eb2f96",closable:""})]),default:e(()=>[t(ee,{spinning:M.value},{default:e(()=>[t($,{size:[24,16],wrap:""},{default:e(()=>{var a;return[(r(!0),x(F,null,j((a=I.value)==null?void 0:a.shopList,s=>(r(),T(Z,{key:s.id,count:X(s)},{default:e(()=>{var _;return[t(m,{type:((_=o.value)==null?void 0:_.id)===s.id?"primary":"default",class:"buyButton",onClick:We=>o.value=s},{default:e(()=>[u(f(s.content.expire===0?"长期":`${s.content.expire}天`),1)]),_:2},1032,["type","onClick"])]}),_:2},1032,["count"]))),128))]}),_:1})]),_:1},8,["spinning"])]),_:1}),t(k,{help:"* 如开启自动续费，请确保账号余额充足"},{title:e(()=>[u(" 自动续费")]),titlePrefix:e(()=>[t(i(Ce),{"two-tone-color":"#52c41a"})]),default:e(()=>[t($,{size:16},{default:e(()=>{var a,s;return[t(m,{disabled:((a=o.value)==null?void 0:a.content.expire)===0,class:"buyButton",type:C.value?"primary":"default",onClick:n[1]||(n[1]=_=>C.value=!0)},{default:e(()=>[u(" 开启 ")]),_:1},8,["disabled","type"]),t(m,{disabled:((s=o.value)==null?void 0:s.content.expire)===0,class:"buyButton",type:C.value?"default":"primary",onClick:n[2]||(n[2]=_=>C.value=!1)},{default:e(()=>[u(" 关闭 ")]),_:1},8,["disabled","type"])]}),_:1})]),_:1}),t(k,{help:"* 正在使用的套餐失效，待购买套餐生效"},{title:e(()=>[u(" 立即生效")]),titlePrefix:e(()=>[t(i(we))]),default:e(()=>[t($,{size:16},{default:e(()=>[t(m,{class:"buyButton",type:w.value?"primary":"default",onClick:n[3]||(n[3]=a=>w.value=!0)},{default:e(()=>[u(" 开启 ")]),_:1},8,["type"]),t(m,{class:"buyButton",type:w.value?"default":"primary",onClick:n[4]||(n[4]=a=>w.value=!1)},{default:e(()=>[u(" 关闭 ")]),_:1},8,["type"])]),_:1})]),_:1}),t(k,{help:"* 默认抵扣账户余额"},{title:e(()=>[u(" 支付方式")]),titlePrefix:e(()=>[t(i(ke))]),default:e(()=>[t($,{size:20},{default:e(()=>[(r(!0),x(F,null,j(i(pe),(a,s)=>(r(),T(de(a),{key:s,payClient:R.value,"onUpdate:payClient":n[5]||(n[5]=_=>R.value=_),open:z.value,"onUpdate:open":n[6]||(n[6]=_=>z.value=_),payPrice:i(V),onClose:Q},null,40,["payClient","open","payPrice"]))),128))]),_:1})]),_:1}),t(k,null,{title:e(()=>[u(" 购买须知")]),titlePrefix:e(()=>[t(i(xe))]),default:e(()=>[t(te,null,{default:e(()=>[Ue]),_:1})]),_:1}),t(ne,{"mb-8":"",bordered:"",title:"支付明细"},{extra:e(()=>{var a;return[t(oe,{ref:"couponRef","shop-id":(a=o.value)==null?void 0:a.id,onApplyCoupon:n[7]||(n[7]=s=>{y.value=s.couponCode,d.value=s.discountedPrice})},null,8,["shop-id"])]}),default:e(()=>[t(N,{label:"套餐名称","content-style":{fontWeight:"bold"},span:3},{default:e(()=>{var a;return[u(f((a=o.value)==null?void 0:a.name),1)]}),_:1}),t(N,{"content-style":A,label:"套餐总价"},{default:e(()=>{var a,s;return[d.value>=0?(r(),x("span",qe,[u(f(d.value)+"元 ",1),v("del",null,f((a=o.value)==null?void 0:a.price)+"元",1)])):(r(),x("span",Le,f((s=o.value)==null?void 0:s.price)+"元 ",1))]}),_:1}),t(N,{"content-style":A,label:"账户余额"},{default:e(()=>{var a;return[u(f((a=i(h).userInfo)==null?void 0:a.money)+"元",1)]}),_:1})]),_:1})]),_:1},8,["open"])}}}),Ze=Fe(Oe,[["__scopeId","data-v-7482c835"]]);export{Ze as default};
